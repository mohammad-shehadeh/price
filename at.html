<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #27ae60;
    }
    body {
      font-family: 'Arial Arabic', Tahoma;
      margin: 0;
      padding: 20px;
      background: #f5f6fa;
    }
    .nav-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    .nav-btn {
      padding: 12px 25px;
      border-radius: 25px;
      background: var(--secondary-color);
      color: white;
      border: none;
      cursor: pointer;
    }
    .page {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .search-filter {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .search-input {
      flex: 1;
      padding: 8px;
      border-radius: 25px;
      border: 1px solid #ddd;
      min-width: 250px;
    }
    .filter-select {
      padding: 8px;
      border-radius: 25px;
      border: 1px solid #ddd;
      background: white;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: scale(1.02);
    }
    .product-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
    }
    .barcode-list {
      margin-top: 10px;
    }
    .barcode-item {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      padding: 5px;
      background: #f0f0f0;
      border-radius: 5px;
      font-size: 14px;
    }
    /* Ù†Ù…Ø· Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª */
    #barcodeModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      z-index: 1000;
      width: 300px;
    }
    #modalOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: 900;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="nav-bar">
    <button class="nav-btn" onclick="showPage('products')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <div id="products" class="page">
    <div class="search-filter">
      <input type="text" class="search-input" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
      <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
      </select>
    </div>
    <div class="products-grid" id="productsContainer"></div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª -->
  <div id="modalOverlay" onclick="closeModal()"></div>
  <div id="barcodeModal">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</h3>
    <div id="barcodeList"></div>
    <input type="text" id="newBarcode" placeholder="Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯">
    <button onclick="addBarcode()">â• Ø¥Ø¶Ø§ÙØ©</button>
    <button onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>

  <script>
    let products = [];
    let categories = new Set();
    let currentProduct = null;

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      document.getElementById(pageId).style.display = 'block';
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØªØ®Ø²ÙŠÙ† Ø¹Ø¯Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù„ÙƒÙ„ ØµÙ†Ù
    async function fetchProducts() {
      try {
        const response = await fetch('test.txt');
        if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù');
        
        const data = await response.text();
        products = data.split('\n')
          .filter(line => line.trim() !== '')
          .map(line => {
            const [category, name, price, image] = line.split('/').map(item => item.trim());
            if (!category || !name || isNaN(price) || !image) {
              console.error('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø±:', line);
              return null;
            }
            categories.add(category);
            return {
              category,
              name,
              price: parseFloat(price),
              image,
              // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª ÙƒÙ…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…
              barcodes: JSON.parse(localStorage.getItem(name) || '[]')
            };
          })
          .filter(product => product !== null);

        updateCategoryFilter();
        renderProducts();
      } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù test.txt ÙˆØ¨Ù†ÙŠØªÙ‡ ØµØ­ÙŠØ­Ø©.');
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¦Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function updateCategoryFilter() {
      const filter = document.getElementById('categoryFilter');
      filter.innerHTML = `<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>` +
        Array.from(categories).map(cat => `<option value="${cat}">${cat}</option>`).join('');
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    function filterProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const selectedCategory = document.getElementById('categoryFilter').value;
      const filtered = products.filter(product => {
        const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                              product.barcodes.some(b => b.toLowerCase().includes(searchTerm));
        const matchesCategory = !selectedCategory || product.category === selectedCategory;
        return matchesSearch && matchesCategory;
      });
      renderProducts(filtered);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function renderProducts(productsToShow = products) {
      const container = document.getElementById('productsContainer');
      container.innerHTML = productsToShow.map(product => `
        <div class="product-card">
          <img src="${product.image}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>Ø§Ù„ÙØ¦Ø©: ${product.category}</p>
          <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price.toFixed(2)} â‚ª</p>
          <div class="barcode-list">
            ${product.barcodes.length > 0 ? product.barcodes.map(b => `<div class="barcode-item">${b}</div>`).join('') : '<em>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ø±ÙƒÙˆØ¯</em>'}
          </div>
          <button onclick="showBarcodeManager('${product.name}')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</button>
        </div>
      `).join('');
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª: Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    function showBarcodeManager(productName) {
      currentProduct = products.find(p => p.name === productName);
      if(!currentProduct) return;
      document.getElementById('barcodeList').innerHTML = currentProduct.barcodes.map(barcode => `
        <div class="barcode-item">
          <span>${barcode}</span>
          <button onclick="removeBarcode('${barcode}')">ğŸ—‘ï¸</button>
        </div>
      `).join('');
      document.getElementById('newBarcode').value = '';
      document.getElementById('modalOverlay').style.display = 'block';
      document.getElementById('barcodeModal').style.display = 'block';
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØµÙ†Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
    function addBarcode() {
      const newBarcode = document.getElementById('newBarcode').value.trim();
      if (!newBarcode) return;
      if (!currentProduct.barcodes.includes(newBarcode)) {
        currentProduct.barcodes.push(newBarcode);
        localStorage.setItem(currentProduct.name, JSON.stringify(currentProduct.barcodes));
        showBarcodeManager(currentProduct.name);
      }
      document.getElementById('newBarcode').value = '';
    }

    // Ø¥Ø²Ø§Ù„Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„ØµÙ†Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
    function removeBarcode(barcode) {
      currentProduct.barcodes = currentProduct.barcodes.filter(b => b !== barcode);
      localStorage.setItem(currentProduct.name, JSON.stringify(currentProduct.barcodes));
      showBarcodeManager(currentProduct.name);
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    function closeModal() {
      document.getElementById('barcodeModal').style.display = 'none';
      document.getElementById('modalOverlay').style.display = 'none';
      renderProducts();
    }

    document.getElementById('searchInput').addEventListener('input', filterProducts);
    document.addEventListener('DOMContentLoaded', fetchProducts);
  </script>
</body>
</html>
