<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #27ae60;
    }
    body {
      font-family: 'Arial Arabic', Tahoma;
      margin: 0;
      padding: 20px;
      background: #f5f6fa;
    }
    .nav-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    .nav-btn {
      padding: 12px 25px;
      border-radius: 25px;
      background: var(--secondary-color);
      color: white;
      border: none;
      cursor: pointer;
    }
    .container {
      display: grid;
      grid-template-columns: 65% 35%;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    .page {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .active-page {
      display: block;
    }
    .search-filter {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .search-input {
      flex: 1;
      padding: 8px;
      border-radius: 25px;
      border: 1px solid #ddd;
      min-width: 250px;
    }
    .filter-select {
      padding: 8px;
      border-radius: 25px;
      border: 1px solid #ddd;
      background: white;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: scale(1.02);
    }
    .product-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
    }
    .pos-interface {
      background: var(--primary-color);
      padding: 20px;
      border-radius: 15px;
      color: white;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .stats-box {
      background: rgba(0,0,0,0.05);
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    /* Ø¨Ø³ÙŠØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
    .quick-items {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fff;
    }
    .quick-item {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .quick-item:last-child {
      border-bottom: none;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="nav-bar">
    <button class="nav-btn" onclick="showPage('pos')">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
    <button class="nav-btn" onclick="showPage('products')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
  </div>

  <!-- ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
  <div id="pos" class="page active-page">
    <div class="container">
      <div>
        <h2>ğŸ’µ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
        <input type="text" id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
        <input type="text" class="search-input" placeholder="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯..." id="barcodeScanner">
        <div id="cartItems" style="max-height: 400px; overflow-y: auto;"></div>
        <div class="stats-box">
          <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: <span id="totalItems">0</span></p>
          <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: <span id="totalQuantities">0</span></p>
          <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total">0.00</span> â‚ª</p>
        </div>
        <button onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        <button onclick="clearCart()">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <div id="products" class="page">
    <div class="search-filter">
      <input type="text" class="search-input" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
      <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
      </select>
    </div>
    <div class="products-grid" id="productsContainer"></div>
    <!-- Ù…Ù†Ø·Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div class="quick-items" id="quickItems">
      <h3>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
      <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø£ØµÙ†Ø§Ù Ù‡Ù†Ø§ -->
    </div>
  </div>

  <script>
    let cart = [];
    let products = [];
    let categories = new Set();

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
      document.getElementById(pageId).classList.add('active-page');
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„Ù…Ø·Ù„ÙˆØ¨
    async function fetchProducts() {
      try {
        // ØªØºÙŠÙŠØ± Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù„ÙŠ
        const response = await fetch('test.txt');
        if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù');
        
        const data = await response.text();
        products = data.split('\n')
          .filter(line => line.trim() !== '') // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ÙØ§Ø±ØºØ©
          .map(line => {
            const [category, name, price, image] = line.split('/').map(item => item.trim());
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!category || !name || isNaN(price) || !image) {
              console.error('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø±:', line);
              return null;
            }
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙƒÙ†Øµ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ localStorage)
            return {
              category,
              name,
              price: parseFloat(price),
              image,
              barcode: localStorage.getItem(name) || ''
            };
          })
          .filter(product => product !== null); // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©

        renderProducts();
        renderQuickItems();
        updateCategoryFilter();
      } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù test.txt');
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¦Ø§Øª
    function updateCategoryFilter() {
      const filter = document.getElementById('categoryFilter');
      // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
      filter.innerHTML = `<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>` +
        Array.from(categories).map(cat => `<option value="${cat}">${cat}</option>`).join('');
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙØ¦Ø©
    function filterProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const selectedCategory = document.getElementById('categoryFilter').value;
      
      const filtered = products.filter(product => {
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ¦Ø§Øª
        categories.add(product.category);
        const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                              product.barcode.toLowerCase().includes(searchTerm);
        const matchesCategory = !selectedCategory || product.category === selectedCategory;
        return matchesSearch && matchesCategory;
      });
      renderProducts(filtered);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function renderProducts(productsToShow = products) {
      const container = document.getElementById('productsContainer');
      container.innerHTML = productsToShow.map(product => `
        <div class="product-card">
          <img src="${product.image}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>Ø§Ù„ÙØ¦Ø©: ${product.category}</p>
          <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price.toFixed(2)} â‚ª</p>
          <p>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${product.barcode || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
          <button onclick="addToCart(product)">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
        </div>
      `).join('');
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ù‚Ø³Ù… Ù…Ù†ÙØµÙ„ (Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·)
    function renderQuickItems() {
      const container = document.getElementById('quickItems');
      container.innerHTML = `<h3>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>` +
        products.map(product => `
          <div class="quick-item">
            <strong>${product.name}</strong> - ${product.price.toFixed(2)} â‚ª
          </div>
        `).join('');
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø©
    function addToCart(product) {
      const existingItem = cart.find(item => item.name === product.name);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const container = document.getElementById('cartItems');
      container.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div>
            <span>${item.name}</span>
            <button onclick="adjustQuantity('${item.name}', -1)">â–</button>
            <span style="margin: 0 10px">x${item.quantity}</span>
            <button onclick="adjustQuantity('${item.name}', 1)">â•</button>
          </div>
          <span>${(item.price * item.quantity).toFixed(2)} â‚ª</span>
        </div>
      `).join('');
      updateTotals();
    }

    function adjustQuantity(productName, change) {
      const item = cart.find(item => item.name === productName);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          cart = cart.filter(i => i !== item);
        }
        updateCartDisplay();
      }
    }

    function updateTotals() {
      const totalItems = cart.length;
      const totalQuantities = cart.reduce((sum, item) => sum + item.quantity, 0);
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById('totalItems').textContent = totalItems;
      document.getElementById('totalQuantities').textContent = totalQuantities;
      document.getElementById('total').textContent = subtotal.toFixed(2);
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙŠ ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
    document.getElementById('barcodeScanner').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const barcode = e.target.value.trim();
        const product = products.find(p => p.barcode === barcode);
        if (product) {
          addToCart(product);
        } else {
          alert('Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„!');
        }
        e.target.value = '';
      }
    });

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
    function printInvoice() {
      const printContent = `
        <style>
          @media print {
            @page { size: 80mm; margin: 0; }
            body { width: 80mm; font-size: 14px; }
            * { margin: 0; padding: 0; }
            .header { text-align: center; padding: 10px; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            hr { border-top: 1px dashed #000; margin: 10px 0; }
          }
        </style>
        <div class="header">
          <h2>ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h2>
          <p>Ø§Ù„Ø²Ø¨ÙˆÙ†: ${document.getElementById('customerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
          <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString()}</p>
        </div>
        <hr>
        ${cart.map(item => `
          <div class="item">
            <span>${item.name} x${item.quantity}</span>
            <span>${(item.price * item.quantity).toFixed(2)} â‚ª</span>
          </div>
        `).join('')}
        <hr>
        <div class="item">
          <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong>
          <strong>${document.getElementById('total').textContent} â‚ª</strong>
        </div>
        <div class="item">
          <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${document.getElementById('totalItems').textContent}</p>
          <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: ${document.getElementById('totalQuantities').textContent}</p>
        </div>
      `;
      const printWindow = window.open('', '_blank');
      printWindow.document.write(printContent);
      printWindow.document.close();
      printWindow.print();
    }

    function clearCart() {
      cart = [];
      document.getElementById('customerName').value = '';
      updateCartDisplay();
    }

    // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
    document.getElementById('searchInput').addEventListener('input', filterProducts);

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', fetchProducts);
  </script>
</body>
</html>
