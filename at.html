<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… POS Ù…ØªØ·ÙˆØ± Ù…Ø¹ Ø¨Ø­Ø« ÙˆØªØµÙÙŠØ©</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #27ae60;
        }

        body {
            font-family: 'Arial Arabic', Tahoma;
            margin: 0;
            padding: 20px;
            background: #f5f6fa;
        }

        .nav-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .nav-btn {
            padding: 12px 25px;
            border-radius: 25px;
            background: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        .container {
            display: grid;
            grid-template-columns: 65% 35%;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .active-page {
            display: block;
        }

        .search-filter {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            padding: 8px;
            border-radius: 25px;
            border: 1px solid #ddd;
            min-width: 250px;
        }

        .filter-select {
            padding: 8px;
            border-radius: 25px;
            border: 1px solid #ddd;
            background: white;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            transition: transform 0.2s;
        }

        .pos-interface {
            background: var(--primary-color);
            padding: 20px;
            border-radius: 15px;
            color: white;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .barcode-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <button class="nav-btn" onclick="showPage('pos')">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
        <button class="nav-btn" onclick="showPage('products')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    </div>

    <!-- ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
    <div id="pos" class="page active-page">
        <div class="container">
            <div>
                <h2>ğŸ’µ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
                <input type="text" id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                <input type="text" class="search-input" placeholder="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯..." id="barcodeScanner">
                
                <div id="cartItems" style="max-height: 400px; overflow-y: auto;"></div>
                
                <div class="stats-box">
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: <span id="totalItems">0</span></p>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: <span id="totalQuantities">0</span></p>
                    <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total">0.00</span> â‚ª</p>
                </div>

                <button onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                <button onclick="clearCart()">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="products" class="page">
        <div class="search-filter">
            <input type="text" class="search-input" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
            <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
            </select>
        </div>
        <div class="products-grid" id="productsContainer"></div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª -->
    <div id="barcodeModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.2);">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</h3>
        <div id="barcodeList"></div>
        <input type="text" id="newBarcode" placeholder="Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯">
        <button onclick="addBarcode()">â• Ø¥Ø¶Ø§ÙØ©</button>
        <button onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

<script>
let cart = [];
let products = [];
let categories = new Set();

async function fetchProducts() {
    try {
        const response = await fetch('test.txt');
        if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù');
        
        const data = await response.text();
        products = data.split('\n')
            .filter(line => line.trim() !== '')
            .map(line => {
                const [category, name, price, image] = line.split('/').map(item => item.trim());
                categories.add(category);
                return {
                    category,
                    name,
                    price: parseFloat(price),
                    image,
                    barcodes: JSON.parse(localStorage.getItem(name) || []
                };
            });

        updateCategoryFilter();
        filterProducts();
    } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù test.txt');
    }
}

function updateCategoryFilter() {
    const filter = document.getElementById('categoryFilter');
    filter.innerHTML = `<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>${
        Array.from(categories).map(cat => 
            `<option value="${cat}">${cat}</option>`
        ).join('')
    }`;
}

function filterProducts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const selectedCategory = document.getElementById('categoryFilter').value;
    
    const filtered = products.filter(product => {
        const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                             product.barcodes.some(b => b.includes(searchTerm));
        const matchesCategory = !selectedCategory || product.category === selectedCategory;
        return matchesSearch && matchesCategory;
    });
    
    renderProducts(filtered);
}

function renderProducts(productsToShow) {
    const container = document.getElementById('productsContainer');
    container.innerHTML = productsToShow.map(product => `
        <div class="product-card">
            <img src="${product.image}" alt="${product.name}" style="height:120px">
            <h3>${product.name}</h3>
            <p>Ø§Ù„ÙØ¦Ø©: ${product.category}</p>
            <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price.toFixed(2)} â‚ª</p>
            <div class="barcode-list">
                ${product.barcodes.map(b => `<div class="barcode-item">${b}</div>`).join('')}
            </div>
            <button onclick="showBarcodeManager('${product.name}')">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</button>
        </div>
    `).join('');
}

// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª
let currentProduct = null;

function showBarcodeManager(productName) {
    currentProduct = products.find(p => p.name === productName);
    const modal = document.getElementById('barcodeModal');
    modal.style.display = 'block';
    
    document.getElementById('barcodeList').innerHTML = currentProduct.barcodes.map(barcode => `
        <div class="barcode-item">
            <span>${barcode}</span>
            <button onclick="removeBarcode('${barcode}')">ğŸ—‘ï¸</button>
        </div>
    `).join('');
}

function addBarcode() {
    const newBarcode = document.getElementById('newBarcode').value.trim();
    if (!newBarcode) return;
    
    if (!currentProduct.barcodes.includes(newBarcode)) {
        currentProduct.barcodes.push(newBarcode);
        localStorage.setItem(currentProduct.name, JSON.stringify(currentProduct.barcodes));
        showBarcodeManager(currentProduct.name);
    }
    document.getElementById('newBarcode').value = '';
}

function removeBarcode(barcode) {
    currentProduct.barcodes = currentProduct.barcodes.filter(b => b !== barcode);
    localStorage.setItem(currentProduct.name, JSON.stringify(currentProduct.barcodes));
    showBarcodeManager(currentProduct.name);
}

function closeModal() {
    document.getElementById('barcodeModal').style.display = 'none';
    filterProducts();
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
document.getElementById('searchInput').addEventListener('input', filterProducts);

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (addToCart, updateCartDisplay, printInvoice, etc.) ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
// ... [ÙŠØªÙ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚] ...

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
fetchProducts();
</script>
</body>
</html>
