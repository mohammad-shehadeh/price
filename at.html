<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… POS Ù…ØªØ·ÙˆØ± - Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #27ae60;
        }

        body {
            font-family: 'Arial Arabic', Tahoma;
            margin: 0;
            padding: 20px;
            background: #f5f6fa;
        }

        .nav-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .nav-btn {
            padding: 12px 25px;
            border-radius: 25px;
            background: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        .container {
            display: grid;
            grid-template-columns: 65% 35%;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .active-page {
            display: block;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            transition: transform 0.2s;
        }

        .pos-interface {
            background: var(--primary-color);
            padding: 20px;
            border-radius: 15px;
            color: white;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        input, button {
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        .stats-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

            /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø¹ Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ù„Ø³ */
    .scanner-input {
      transition: box-shadow 0.3s ease;
      padding: 8px;
      font-size: 16px;
      outline: none;
    }
    /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ø£Ø®Ø¶Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
    .scanner-input.focused {
      box-shadow: 0 0 5px 2px green;
    }
    /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ø£Ø­Ù…Ø± Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² */
    .scanner-input.not-focused {
      box-shadow: 0 0 5px 2px red;
    }
    </style>
</head>
<body>
    <div class="nav-bar">
        <button class="nav-btn" onclick="showPage('pos')">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
        <button class="nav-btn" onclick="showPage('products')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    </div>

    <!-- ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
    <div id="pos" class="page active-page">
        <div class="container">
            <div>
                <h2>ğŸ’µ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
                <input type="text" id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                <input type="text" class="scanner-input" placeholder="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯..." id="barcodeScanner">
                
                <div id="cartItems" style="max-height: 400px; overflow-y: auto;"></div>
                
                <div class="stats-box">
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: <span id="totalItems">0</span></p>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: <span id="totalQuantities">0</span></p>
                    <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total">0.00</span> â‚ª</p>
                </div>

                <button onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                <button onclick="clearCart()">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="products" class="page">
        <h2>ğŸ›ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        <div class="products-grid" id="productsContainer"></div>
    </div>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
let cart = [];
let products = [];

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(pageId).classList.add('active-page');
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†ØµÙŠ
async function fetchProducts() {
    try {
        const response = await fetch('test.txt');
        if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù');
        
        const data = await response.text();
        products = data.split('\n')
            .filter(line => line.trim() !== '')
            .map(line => {
                const [category, name, price, image] = line.split('/').map(item => item.trim());
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                let storedBarcodes = localStorage.getItem(name);
                try {
                    storedBarcodes = storedBarcodes ? JSON.parse(storedBarcodes) : [];
                } catch {
                    storedBarcodes = storedBarcodes ? [storedBarcodes] : [];
                }
                
                return {
                    category,
                    name,
                    price: parseFloat(price),
                    image,
                    barcodes: storedBarcodes
                };
            });

        renderProducts();
    } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù test.txt');
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function renderProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    
    products.forEach(product => {
        // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ù„ØªÙƒÙˆÙŠÙ† Ù…Ø¹Ø±Ù ØµØ§Ù„Ø­
        const productId = product.name.replace(/\s+/g, '-');
        const barcodeInputs = product.barcodes.map((barcode, index) => 
            `<input type="text" value="${barcode}" 
                    onchange="updateBarcodeField('${product.name}', ${index}, this.value)" 
                    placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯ ${index+1}">`
        ).join('');
        
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
            <img src="${product.image}" alt="${product.name}" style="height:120px">
            <h3>${product.name}</h3>
            <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price.toFixed(2)} â‚ª</p>
            <div id="barcodes-container-${productId}">
                ${barcodeInputs}
            </div>
            <button onclick="addBarcodeField('${product.name}')">Ø£Ø¶Ù Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
        `;
        container.appendChild(card);
    });
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø­Ù‚Ù„ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø­Ø¯Ø¯
function updateBarcodeField(productName, index, newValue) {
    const product = products.find(p => p.name === productName);
    if (product) {
        product.barcodes[index] = newValue.trim();
        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStorage.setItem(productName, JSON.stringify(product.barcodes));
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯
function addBarcodeField(productName) {
    const product = products.find(p => p.name === productName);
    if (product) {
        // Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© ÙØ§Ø±ØºØ© ÙƒØ­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯
        product.barcodes.push('');
        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        localStorage.setItem(productName, JSON.stringify(product.barcodes));
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø­Ø°Ù ÙˆØ¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯
        const productId = product.name.replace(/\s+/g, '-');
        const container = document.getElementById(`barcodes-container-${productId}`);
        const newIndex = product.barcodes.length - 1;
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.placeholder = `Ø¨Ø§Ø±ÙƒÙˆØ¯ ${newIndex + 1}`;
        newInput.onchange = function() {
            updateBarcodeField(productName, newIndex, this.value);
        };
        container.appendChild(newInput);
    }
}

document.getElementById('barcodeScanner').addEventListener('keydown', (e) => {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Enter ÙˆØ¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­Ø¯Ø«
    if (e.key === 'Enter' && !e.repeat) {
        e.preventDefault(); // Ù…Ù†Ø¹ ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

        const barcode = e.target.value.trim();
        const product = products.find(p => p.barcodes.includes(barcode));
        
        if (product) {
            addToCart(product);
        } else {
            alert('Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„!');
        }
        
        e.target.value = '';
    }
});



// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø©
function addToCart(product) {
    const existingItem = cart.find(item => item.name === product.name);
    existingItem ? existingItem.quantity++ : cart.push({...product, quantity: 1});
    updateCartDisplay();
}

function updateCartDisplay() {
    const container = document.getElementById('cartItems');
    container.innerHTML = cart.map(item => `
        <div class="cart-item">
            <div>
                <span>${item.name}</span>
                <button onclick="adjustQuantity('${item.name}', -1)">â–</button>
                <span style="margin: 0 10px">x${item.quantity}</span>
                <button onclick="adjustQuantity('${item.name}', 1)">â•</button>
            </div>
            <span>${(item.price * item.quantity).toFixed(2)} â‚ª</span>
        </div>
    `).join('');
    
    updateTotals();
}

function updateTotals() {
    const totalItems = cart.length;
    const totalQuantities = cart.reduce((sum, item) => sum + item.quantity, 0);
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    
    document.getElementById('totalItems').textContent = totalItems;
    document.getElementById('totalQuantities').textContent = totalQuantities;
    document.getElementById('total').textContent = subtotal.toFixed(2);
}

function adjustQuantity(productName, change) {
    const item = cart.find(item => item.name === productName);
    item.quantity += change;
    if (item.quantity <= 0) cart = cart.filter(i => i !== item);
    updateCartDisplay();
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
function updateBarcode(productName, barcode) {
    localStorage.setItem(productName, barcode);
    const product = products.find(p => p.name === productName);
    if (product) product.barcode = barcode;
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ
document.getElementById('barcodeScanner').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const barcode = e.target.value;
        const product = products.find(p => p.barcode === barcode);
        product ? addToCart(product) : alert('Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„!');
        e.target.value = '';
    }
});

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
function printInvoice() {
    const printContent = `
        <style>
            @media print {
                @page { size: 80mm; margin: 0; }
                body { width: 80mm; font-size: 14px; }
                * { margin: 0; padding: 0; }
                .header { text-align: center; padding: 10px; }
                .item { display: flex; justify-content: space-between; margin: 5px 0; }
                hr { border-top: 1px dashed #000; margin: 10px 0; }
            }
        </style>
        <div class="header">
            <h2>ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h2>
            <p>Ø§Ù„Ø²Ø¨ÙˆÙ†: ${document.getElementById('customerName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
            <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString()}</p>
        </div>
        <hr>
        ${cart.map(item => `
            <div class="item">
                <span>${item.name} x${item.quantity}</span>
                <span>${(item.price * item.quantity).toFixed(2)} â‚ª</span>
            </div>
        `).join('')}
        <hr>
        <div class="item">
            <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong>
            <strong>${document.getElementById('total').textContent} â‚ª</strong>
        </div>
        <div class="item">
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${document.getElementById('totalItems').textContent}</p>
            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: ${document.getElementById('totalQuantities').textContent}</p>
        </div>
    `;

    const printWindow = window.open('', '_blank');
    printWindow.document.write(printContent);
    printWindow.document.close();
    printWindow.print();
}

function clearCart() {
    cart = [];
    document.getElementById('customerName').value = '';
    updateCartDisplay();
}

document.addEventListener('DOMContentLoaded', function() {
      const barcodeInput = document.getElementById('barcodeScanner');
      
      // ØªØ±ÙƒÙŠØ² Ø§Ù„Ø­Ù‚Ù„ ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
      barcodeInput.focus();
      barcodeInput.classList.add('focused');
      barcodeInput.classList.remove('not-focused');

      // Ø¹Ù†Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ²
      barcodeInput.addEventListener('focus', () => {
        barcodeInput.classList.add('focused');
        barcodeInput.classList.remove('not-focused');
      });
      
      // Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ²
      barcodeInput.addEventListener('blur', () => {
        barcodeInput.classList.add('not-focused');
        barcodeInput.classList.remove('focused');
      });
      
      // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø© (Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰)
      document.addEventListener('click', (e) => {
        if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
          barcodeInput.focus();
        }
      });
    });

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
fetchProducts();
</script>
</body>
</html>
