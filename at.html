<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
        }

        body {
            font-family: 'Arial Arabic', Tahoma;
            margin: 0;
            padding: 20px;
            background: #ecf0f1;
        }

        .container {
            display: grid;
            grid-template-columns: 65% 35%;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .products-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-3px);
        }

        .pos-interface {
            background: var(--primary-color);
            padding: 20px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .barcode-input {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: opacity 0.3s;
            margin: 5px;
        }

        button:hover {
            opacity: 0.9;
        }

        .quick-items {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .scanner-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 25px;
            border: none;
        }

        .discount-input {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px;
            width: 80px;
            text-align: center;
        }

        img {
            max-width: 100%;
            height: 120px;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <div class="products-section">
            <h2>ğŸ›ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
            <input type="text" class="scanner-input" placeholder="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù‡Ù†Ø§..." id="barcodeScanner">
            <div class="products-grid" id="productsContainer"></div>
        </div>

        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
        <div class="pos-interface">
            <h2>ğŸ’µ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
            <div id="cartItems" style="max-height: 400px; overflow-y: auto;"></div>
            
            <div class="quick-items">
                <h3>âš¡ Ø£ØµÙ†Ø§Ù Ø³Ø±ÙŠØ¹Ø©</h3>
                <div id="quickItemsList"></div>
                <input type="text" id="newItemName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                <input type="number" id="newItemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                <button onclick="addQuickItem()">â• Ø¥Ø¶Ø§ÙØ©</button>
            </div>

            <div id="totals" style="margin-top: 20px;">
                <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="subtotal">0.00</span> $</p>
                <input type="number" id="discount" class="discount-input" placeholder="Ø®ØµÙ… %">
                <button onclick="applyDiscount()">ğŸ’¸ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…</button>
                <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total">0.00</span> $</p>
            </div>

            <div style="margin-top: 20px;">
                <button class="print-btn" onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                <button onclick="clearCart()">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
                <button onclick="showBarcodeManager()">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
    <div id="barcodeModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.2);">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h3>
        <div id="barcodeList"></div>
        <button onclick="document.getElementById('barcodeModal').style.display = 'none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
let cart = [];
let products = [];

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†ØµÙŠ
// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function fetchProducts() {
    try {
        // ØªØºÙŠÙŠØ± Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù„ÙŠ
        const response = await fetch('test.txt');
        if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù');
        
        const data = await response.text();
        products = data.split('\n')
            .filter(line => line.trim() !== '') // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ÙØ§Ø±ØºØ©
            .map(line => {
                const [category, name, price, image] = line.split('/').map(item => item.trim());
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (!category || !name || isNaN(price) || !image) {
                    console.error('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø±:', line);
                    return null;
                }
                
                return {
                    category,
                    name,
                    price: parseFloat(price),
                    image,
                    barcode: localStorage.getItem(name) || ''
                };
            })
            .filter(product => product !== null); // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©

        renderProducts();
        renderQuickItems();
    } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù test.txt');
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function renderProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    
    products.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
            <img src="${product.image}" alt="${product.name}">
            <h3>${product.name}</h3>
            <p>Ø§Ù„Ø³Ø¹Ø±: $${product.price.toFixed(2)}</p>
            <input type="text" class="barcode-input" 
                   placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯" 
                   value="${product.barcode}"
                   onchange="updateBarcode('${product.name}', this.value)">
        `;
        card.onclick = () => addToCart(product);
        container.appendChild(card);
    });
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø©
function addToCart(product) {
    const existingItem = cart.find(item => item.name === product.name);
    if (existingItem) {
        existingItem.quantity++;
    } else {
        cart.push({...product, quantity: 1});
    }
    updateCartDisplay();
}

function updateCartDisplay() {
    const container = document.getElementById('cartItems');
    container.innerHTML = cart.map(item => `
        <div class="cart-item">
            <div>
                <span>${item.name}</span>
                <button onclick="adjustQuantity('${item.name}', -1)">â–</button>
                <span style="margin: 0 10px">x${item.quantity}</span>
                <button onclick="adjustQuantity('${item.name}', 1)">â•</button>
            </div>
            <span>$${(item.price * item.quantity).toFixed(2)}</span>
        </div>
    `).join('');
    
    calculateTotals();
}

function adjustQuantity(productName, change) {
    const item = cart.find(item => item.name === productName);
    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            cart = cart.filter(i => i !== item);
        }
        updateCartDisplay();
    }
}

// Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
function calculateTotals() {
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    document.getElementById('subtotal').textContent = subtotal.toFixed(2);
    updateTotal();
}

function applyDiscount() {
    updateTotal();
}

function updateTotal() {
    const subtotal = parseFloat(document.getElementById('subtotal').textContent);
    const discount = parseFloat(document.getElementById('discount').value) || 0;
    const total = subtotal * (1 - discount / 100);
    document.getElementById('total').textContent = total.toFixed(2);
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
function updateBarcode(productName, barcode) {
    localStorage.setItem(productName, barcode);
    const product = products.find(p => p.name === productName);
    if (product) product.barcode = barcode;
}

function showBarcodeManager() {
    const modal = document.getElementById('barcodeModal');
    modal.style.display = 'block';
    document.getElementById('barcodeList').innerHTML = products.map(p => `
        <div style="margin: 10px 0">
            <strong>${p.name}</strong>
            <input type="text" value="${p.barcode}" 
                   onchange="updateBarcode('${p.name}', this.value)">
        </div>
    `).join('');
}

// Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
function addQuickItem() {
    const name = document.getElementById('newItemName').value;
    const price = parseFloat(document.getElementById('newItemPrice').value);
    
    if (name && price) {
        const quickItems = JSON.parse(localStorage.getItem('quickItems') || []);
        quickItems.push({name, price});
        localStorage.setItem('quickItems', JSON.stringify(quickItems));
        renderQuickItems();
    }
}

function renderQuickItems() {
    const quickItems = JSON.parse(localStorage.getItem('quickItems') || '[]');
    const container = document.getElementById('quickItemsList');
    container.innerHTML = quickItems.map(item => `
        <button style="margin: 5px" 
                onclick="addToCart({name: '${item.name}', price: ${item.price}, quantity: 1})">
            ${item.name} - $${item.price.toFixed(2)}
        </button>
    `).join('');
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ
document.getElementById('barcodeScanner').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const barcode = e.target.value;
        const product = products.find(p => p.barcode === barcode);
        if (product) {
            addToCart(product);
            e.target.value = '';
        } else {
            alert('Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„!');
        }
    }
});

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
function printInvoice() {
    const printContent = `
        <style>
            @media print {
                @page { size: 80mm; margin: 0; }
                body { width: 80mm; font-size: 14px; }
                * { margin: 0; padding: 0; }
                .invoice-header { text-align: center; padding: 10px; }
                .item { display: flex; justify-content: space-between; margin: 5px 0; }
                hr { border-top: 1px dashed #000; margin: 10px 0; }
            }
        </style>
        <div class="invoice-header">
            <h2>ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h2>
            <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString()}</p>
        </div>
        <hr>
        ${cart.map(item => `
            <div class="item">
                <span>${item.name} x${item.quantity}</span>
                <span>$${(item.price * item.quantity).toFixed(2)}</span>
            </div>
        `).join('')}
        <hr>
        <div class="item">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span>$${document.getElementById('subtotal').textContent}</span>
        </div>
        <div class="item">
            <span>Ø§Ù„Ø®ØµÙ…:</span>
            <span>${document.getElementById('discount').value || 0}%</span>
        </div>
        <div class="item">
            <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong>
            <strong>$${document.getElementById('total').textContent}</strong>
        </div>
    `;

    const printWindow = window.open('', '_blank');
    printWindow.document.write(printContent);
    printWindow.document.close();
    printWindow.print();
}

function clearCart() {
    cart = [];
    updateCartDisplay();
    document.getElementById('discount').value = '';
    calculateTotals();
}

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
fetchProducts();
</script>
</body>
</html>
