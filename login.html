<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ - ØªØ­Ù‚Ù‚ Ù…Ù† Firebase</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .step-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .step-indicator.active {
            background: #2563eb;
            color: white;
            transform: scale(1.1);
        }
        .step-indicator.completed {
            background: #10b981;
            color: white;
        }
        .firebase-status {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .firebase-status.connected {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .firebase-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 min-h-screen">
    <div class="w-full max-w-md mx-auto">
        <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
        <div class="text-center mb-8">
            <div class="inline-block p-4 bg-white/10 backdrop-blur-sm rounded-2xl mb-4">
                <div class="text-3xl">ğŸ”</div>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ Ø§Ù„Ø¢Ù…Ù†</h1>
            <p class="text-blue-100">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ</p>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div class="card rounded-2xl shadow-2xl p-6 mb-6">
            <!-- Ø­Ø§Ù„Ø© Firebase -->
            <div id="firebase-connection" class="mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-gray-300 mr-2" id="firebase-dot"></div>
                        <span class="text-sm text-gray-600" id="firebase-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase...</span>
                    </div>
                    <div id="firebase-badge" class="firebase-status">...</div>
                </div>
            </div>

            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø®Ø·ÙˆØ§Øª -->
            <div class="flex items-center justify-center mb-8">
                <div class="flex items-center">
                    <div class="step-indicator active" id="step1-indicator">
                        1
                    </div>
                    <div class="w-16 h-1 bg-gray-300 mx-2"></div>
                    <div class="step-indicator" id="step2-indicator">
                        2
                    </div>
                    <div class="w-16 h-1 bg-gray-300 mx-2"></div>
                    <div class="step-indicator" id="step3-indicator">
                        3
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… -->
            <div id="step-enter-phone" class="step">
                <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">
                    <i class="fas fa-mobile-alt text-blue-500 mr-2"></i>
                    Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„Ù„ØªØ­Ù‚Ù‚
                </h2>

                <div class="mb-6">
                    <label class="block text-gray-700 mb-2 font-medium">
                        Ø§Ø®ØªØ± Ø±Ù…Ø² ÙˆØ§ØªØ³Ø§Ø¨
                    </label>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button 
                            id="btn-972" 
                            class="p-3 border-2 border-blue-300 rounded-lg bg-blue-50 font-bold"
                            onclick="selectCountryCode('972')"
                        >
                            ğŸ‡µğŸ‡¸ +972
                        </button>
                        <button 
                            id="btn-970" 
                            class="p-3 border-2 border-gray-300 rounded-lg bg-gray-50 font-bold"
                            onclick="selectCountryCode('970')"
                        >
                            ğŸ‡µğŸ‡¸ +970
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2 font-medium">
                            Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (9 Ø£Ø±Ù‚Ø§Ù…)
                        </label>
                        <div class="flex items-center border-2 border-gray-300 rounded-lg overflow-hidden">
                            <div class="bg-gray-100 px-4 py-3 font-bold text-gray-700 border-r border-gray-300">
                                <span id="country-code-display">+972</span>
                            </div>
                            <input 
                                type="tel" 
                                id="phone-input" 
                                class="flex-1 p-3 outline-none text-center text-lg"
                                placeholder="59XXXXXXX"
                                dir="ltr"
                                maxlength="9"
                                oninput="validatePhoneInput(this)"
                            >
                        </div>
                        <p class="text-sm text-gray-500 mt-2">
                            ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù…
                        </p>
                    </div>
                </div>

                <div class="space-y-3">
                    <button 
                        id="check-firebase-btn" 
                        onclick="checkFirebaseNumber()"
                        class="btn-primary w-full text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center"
                    >
                        <i class="fas fa-search ml-2"></i>
                        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Firebase
                    </button>
                    
                    <div class="text-center">
                        <button 
                            onclick="useTestNumber()"
                            class="text-sm text-blue-600 hover:text-blue-800"
                        >
                            <i class="fas fa-flask ml-1"></i>
                            Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ø®ØªØ¨Ø§Ø±ÙŠ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
            <div id="step-check-result" class="step hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">
                    <i class="fas fa-clipboard-check text-green-500 mr-2"></i>
                    Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase
                </h2>

                <div id="check-result" class="mb-6">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>

                <div class="space-y-3">
                    <button 
                        id="auto-login-btn" 
                        onclick="proceedToAutoLogin()"
                        class="btn-primary w-full text-white font-bold py-3 px-4 rounded-lg hidden"
                    >
                        <i class="fas fa-sign-in-alt ml-2"></i>
                        Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ
                    </button>
                    
                    <button 
                        onclick="goBackToPhoneInput()"
                        class="w-full border border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg"
                    >
                        <i class="fas fa-arrow-right ml-2"></i>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¢Ø®Ø±
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ -->
            <div id="step-auto-login" class="step hidden">
                <div class="text-center py-6">
                    <div class="loading mx-auto mb-4"></div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2" id="auto-login-title">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ...</h2>
                    <p class="text-gray-600 mb-6" id="auto-login-text">
                        ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    </p>
                    
                    <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-700">Ø±Ù‚Ù… Firebase:</span>
                                <span id="auto-login-phone" class="font-bold">+972 5XXXXXXXX</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-700">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚:</span>
                                <span id="auto-login-status" class="font-bold">Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-700">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª:</span>
                                <span class="font-mono bg-gray-100 px-2 py-1 rounded">382659</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="auto-login-error" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                            <span id="auto-login-error-text" class="text-red-700"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div class="text-center text-white/80 text-sm mt-6">
            <p>
                <i class="fas fa-database mr-2"></i>
                <strong>Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø¢Ù…Ù†:</strong> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase â†’ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ â†’ ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„Ù…ÙˆÙ‚Ø¹
            </p>
        </div>
    </div>

    <!-- Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ -->
    <div id="original-site" class="hidden fixed inset-0 bg-white z-50 overflow-y-auto">
        <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
            <nav class="bg-white shadow-lg">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="text-2xl text-blue-600 mr-3">ğŸ </div>
                            <h1 class="text-xl font-bold text-gray-800">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ</h1>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span id="user-display" class="text-gray-700"></span>
                            <button 
                                onclick="logoutFromSite()"
                                class="bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition"
                            >
                                <i class="fas fa-sign-out-alt ml-2"></i>
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
            <div class="container mx-auto px-4 py-8">
                <div class="max-w-4xl mx-auto">
                    <!-- Ø¨Ø·Ø§Ù‚Ø© ØªØ±Ø­ÙŠØ¨ -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="text-center mb-6">
                            <div class="w-20 h-20 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-white text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
                            <p class="text-gray-600">ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù…Ùƒ ÙÙŠ Firebase ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ</p>
                        </div>

                        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                        <div class="bg-gray-50 rounded-xl p-6 mb-6">
                            <h3 class="font-bold text-gray-800 mb-4 text-lg">
                                <i class="fas fa-user-check text-blue-500 mr-2"></i>
                                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                                    <span id="site-phone" class="font-bold">+972 5XXXXXXXX</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©:</span>
                                    <span id="site-country" class="font-bold">+972</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Ø­Ø§Ù„Ø© Firebase:</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Ù…Ø³Ø¬Ù„</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                    <span id="site-login-time" class="font-mono"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-700">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">Ø¢Ù„ÙŠ Ø¨Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
                        <div class="text-center">
                            <button 
                                onclick="backToLogin()"
                                class="inline-flex items-center bg-gray-200 text-gray-800 font-bold px-6 py-3 rounded-lg hover:bg-gray-300 transition"
                            >
                                <i class="fas fa-arrow-right ml-2"></i>
                                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBWfV0Z1yKxJ-lGJHzi5gStMGTE3CNxmMg",
            authDomain: "aasa-8a079.firebaseapp.com",
            projectId: "aasa-8a079",
            storageBucket: "aasa-8a079.firebasestorage.app",
            databaseURL: "https://aasa-8a079-default-rtdb.firebaseio.com",
            messagingSenderId: "849330713582",
            appId: "1:849330713582:web:7a11b11ebdb5cdcc8b14ff",
            measurementId: "G-LY2WSQ21GE"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let app;
        let auth;
        let database;
        let recaptchaVerifier;

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let selectedCountryCode = "972";
        let currentPhoneNumber = "";
        let firebaseUserExists = false;
        
        // Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ù„ØªØ­Ù‚Ù‚
        const STATIC_VERIFICATION_CODE = "382659";

        // Ø¹Ù†Ø§ØµØ± DOM
        const elements = {
            // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            firebaseDot: document.getElementById('firebase-dot'),
            firebaseText: document.getElementById('firebase-text'),
            firebaseBadge: document.getElementById('firebase-badge'),
            
            // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ§Øª
            step1Indicator: document.getElementById('step1-indicator'),
            step2Indicator: document.getElementById('step2-indicator'),
            step3Indicator: document.getElementById('step3-indicator'),
            
            // Ø§Ù„Ø®Ø·ÙˆØ§Øª
            stepEnterPhone: document.getElementById('step-enter-phone'),
            stepCheckResult: document.getElementById('step-check-result'),
            stepAutoLogin: document.getElementById('step-auto-login'),
            originalSite: document.getElementById('original-site'),
            
            // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù…
            countryCodeDisplay: document.getElementById('country-code-display'),
            phoneInput: document.getElementById('phone-input'),
            btn972: document.getElementById('btn-972'),
            btn970: document.getElementById('btn-970'),
            
            // Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚
            checkResult: document.getElementById('check-result'),
            autoLoginBtn: document.getElementById('auto-login-btn'),
            
            // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ
            autoLoginTitle: document.getElementById('auto-login-title'),
            autoLoginText: document.getElementById('auto-login-text'),
            autoLoginPhone: document.getElementById('auto-login-phone'),
            autoLoginStatus: document.getElementById('auto-login-status'),
            autoLoginError: document.getElementById('auto-login-error'),
            autoLoginErrorText: document.getElementById('auto-login-error-text'),
            
            // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ
            userDisplay: document.getElementById('user-display'),
            sitePhone: document.getElementById('site-phone'),
            siteCountry: document.getElementById('site-country'),
            siteLoginTime: document.getElementById('site-login-time')
        };

        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Firebase =====
        function updateFirebaseStatus(connected, message = "") {
            if (connected) {
                elements.firebaseDot.style.backgroundColor = "#10b981";
                elements.firebaseText.textContent = message || "Firebase Ù…ØªØµÙ„";
                elements.firebaseBadge.className = "firebase-status connected";
                elements.firebaseBadge.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Ù…ØªØµÙ„';
            } else {
                elements.firebaseDot.style.backgroundColor = "#ef4444";
                elements.firebaseText.textContent = message || "Firebase ØºÙŠØ± Ù…ØªØµÙ„";
                elements.firebaseBadge.className = "firebase-status disconnected";
                elements.firebaseBadge.innerHTML = '<i class="fas fa-times-circle mr-1"></i> ØºÙŠØ± Ù…ØªØµÙ„';
            }
        }

        // ===== Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø© =====
        function selectCountryCode(code) {
            selectedCountryCode = code;
            elements.countryCodeDisplay.textContent = `+${code}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            if (code === "972") {
                elements.btn972.classList.remove('border-gray-300', 'bg-gray-50');
                elements.btn972.classList.add('border-blue-300', 'bg-blue-50');
                elements.btn970.classList.remove('border-blue-300', 'bg-blue-50');
                elements.btn970.classList.add('border-gray-300', 'bg-gray-50');
            } else {
                elements.btn970.classList.remove('border-gray-300', 'bg-gray-50');
                elements.btn970.classList.add('border-blue-300', 'bg-blue-50');
                elements.btn972.classList.remove('border-blue-300', 'bg-blue-50');
                elements.btn972.classList.add('border-gray-300', 'bg-gray-50');
            }
        }

        // ===== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‡Ø§ØªÙ =====
        function validatePhoneInput(input) {
            let value = input.value;
            
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
            value = value.replace(/\D/g, '');
            
            // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 9 Ø£Ø±Ù‚Ø§Ù…
            if (value.length > 9) {
                value = value.substring(0, 9);
            }
            
            input.value = value;
            
            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø­Ù‚Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµØ­Ø©
            if (value.length === 9 && value.startsWith('5')) {
                input.classList.add('border-green-500');
                input.classList.remove('border-red-500');
            } else {
                input.classList.add('border-red-500');
                input.classList.remove('border-green-500');
            }
        }

        function useTestNumber() {
            elements.phoneInput.value = "599123456";
            validatePhoneInput(elements.phoneInput);
        }

        // ===== ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ§Øª =====
        function updateStepIndicator(step, status) {
            const indicator = document.getElementById(`step${step}-indicator`);
            indicator.className = "step-indicator";
            
            if (status === "active") {
                indicator.classList.add("active");
            } else if (status === "completed") {
                indicator.classList.add("completed");
                indicator.innerHTML = '<i class="fas fa-check"></i>';
            }
        }

        function goToStep(step) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª
            elements.stepEnterPhone.classList.add('hidden');
            elements.stepCheckResult.classList.add('hidden');
            elements.stepAutoLogin.classList.add('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ§Øª
            if (step === 1) {
                elements.stepEnterPhone.classList.remove('hidden');
                updateStepIndicator(1, "active");
                updateStepIndicator(2, "inactive");
                updateStepIndicator(3, "inactive");
            } else if (step === 2) {
                elements.stepCheckResult.classList.remove('hidden');
                updateStepIndicator(1, "completed");
                updateStepIndicator(2, "active");
                updateStepIndicator(3, "inactive");
            } else if (step === 3) {
                elements.stepAutoLogin.classList.remove('hidden');
                updateStepIndicator(1, "completed");
                updateStepIndicator(2, "completed");
                updateStepIndicator(3, "active");
            }
        }

        function goBackToPhoneInput() {
            goToStep(1);
        }

        // ===== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Firebase =====
        async function checkFirebaseNumber() {
            const phoneNumber = elements.phoneInput.value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù…
            if (phoneNumber.length !== 9 || !phoneNumber.startsWith('5')) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5');
                return;
            }
            
            currentPhoneNumber = phoneNumber;
            const fullPhoneNumber = `+${selectedCountryCode}${phoneNumber}`;
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© 2
            goToStep(2);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            elements.checkResult.innerHTML = `
                <div class="text-center py-6">
                    <div class="loading mx-auto mb-4"></div>
                    <h3 class="font-bold text-gray-800 mb-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase...</h3>
                    <p class="text-gray-600">ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ ÙÙŠ Ù†Ø¸Ø§Ù… Firebase</p>
                </div>
            `;
            
            elements.autoLoginBtn.classList.add('hidden');
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
                if (!auth) {
                    throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
                }
                
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø¹Ø±ÙØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹
                let userExists = false;
                let userInfo = null;
                
                try {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ (Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„)
                    if (!recaptchaVerifier) {
                        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('check-firebase-btn', {
                            'size': 'invisible'
                        });
                    }
                    
                    await auth.signInWithPhoneNumber(fullPhoneNumber, recaptchaVerifier);
                    
                    // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ù‡Ù†Ø§ØŒ Ø§Ù„Ø±Ù‚Ù… ØµØ§Ù„Ø­ Ù„Ù„ØªØ³Ø¬ÙŠÙ„
                    userExists = true;
                    
                } catch (firebaseError) {
                    console.log('Firebase check error:', firebaseError);
                    
                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø®Ø·Ø£
                    if (firebaseError.code === 'auth/too-many-requests') {
                        // Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                        userExists = true;
                    } else if (firebaseError.code === 'auth/invalid-phone-number') {
                        // Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­
                        userExists = false;
                    } else if (firebaseError.code === 'auth/quota-exceeded') {
                        // ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ - Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                        userExists = true;
                    } else {
                        // Ø£Ø®Ø·Ø§Ø¡ Ø£Ø®Ø±Ù‰ - Ù†ÙØªØ±Ø¶ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
                        userExists = false;
                    }
                }
                
                firebaseUserExists = userExists;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                if (userExists) {
                    elements.checkResult.innerHTML = `
                        <div class="p-6 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-check text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-green-800 text-lg">Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ ÙÙŠ Firebase</h3>
                                    <p class="text-green-700">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ</p>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg">
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</span>
                                        <span class="font-bold">${fullPhoneNumber}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù…:</span>
                                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">Ù…Ø³Ø¬Ù„</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                        <span class="text-blue-600 font-medium">Ø¢Ù„ÙŠ Ø¨Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-700">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª <strong>382659</strong> Ù„Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                                </p>
                            </div>
                        </div>
                    `;
                    
                    elements.autoLoginBtn.classList.remove('hidden');
                    
                } else {
                    elements.checkResult.innerHTML = `
                        <div class="p-6 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-times text-red-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-red-800 text-lg">Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Firebase</h3>
                                    <p class="text-red-700">Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase</p>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg mb-4">
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ø®Ù„:</span>
                                        <span class="font-bold">${fullPhoneNumber}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù…:</span>
                                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ ÙØ¹Ù„Ù‡ØŸ</h4>
                                <ul class="text-sm text-yellow-700 space-y-1 list-disc list-inside">
                                    <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Firebase</li>
                                    <li>Ø¬Ø±Ø¨ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¢Ø®Ø±</li>
                                    <li>Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Firebase check failed:', error);
                
                elements.checkResult.innerHTML = `
                    <div class="p-6 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-yellow-800 text-lg">ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase</h3>
                                <p class="text-yellow-700">${error.message || "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <button 
                                onclick="retryFirebaseCheck()"
                                class="w-full bg-yellow-100 text-yellow-800 font-bold py-3 px-4 rounded-lg"
                            >
                                <i class="fas fa-redo ml-2"></i>
                                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                            
                            <div class="p-3 bg-white rounded-lg">
                                <p class="text-sm text-gray-600">
                                    ÙŠÙ…ÙƒÙ†Ùƒ <strong>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¹ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</strong> Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±
                                </p>
                                <button 
                                    onclick="proceedWithTestMode()"
                                    class="mt-2 text-sm text-blue-600 hover:text-blue-800"
                                >
                                    <i class="fas fa-flask ml-1"></i>
                                    Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function retryFirebaseCheck() {
            checkFirebaseNumber();
        }

        function proceedWithTestMode() {
            firebaseUserExists = true; // Ø§Ø¹ØªØ¨Ø§Ø± Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            proceedToAutoLogin();
        }

        // ===== Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ =====
        function proceedToAutoLogin() {
            if (!firebaseUserExists) {
                alert('Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Firebase. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.');
                return;
            }
            
            const fullPhoneNumber = `+${selectedCountryCode}${currentPhoneNumber}`;
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© 3
            goToStep(3);
            
            elements.autoLoginPhone.textContent = fullPhoneNumber;
            elements.autoLoginStatus.textContent = firebaseUserExists ? "Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…" : "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
            elements.autoLoginError.classList.add('hidden');
            
            // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ
            performAutoLogin();
        }

        async function performAutoLogin() {
            const fullPhoneNumber = `+${selectedCountryCode}${currentPhoneNumber}`;
            
            try {
                // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ø¶ÙŠØ±
                elements.autoLoginTitle.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ...";
                elements.autoLoginText.textContent = "ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ";
                await delay(1000);
                
                // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ù„ØªØ­Ù‚Ù‚
                elements.autoLoginTitle.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª...";
                elements.autoLoginText.textContent = "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù…Ø² 382659 Ù„Ù„ØªØ­Ù‚Ù‚";
                await delay(1500);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase
                let verificationSuccess = false;
                
                if (auth) {
                    try {
                        // Ø¥Ù†Ø´Ø§Ø¡ reCAPTCHA Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                        if (!recaptchaVerifier) {
                            recaptchaVerifier = new firebase.auth.RecaptchaVerifier('auto-login-btn', {
                                'size': 'invisible'
                            });
                        }
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
                        const confirmationResult = await auth.signInWithPhoneNumber(fullPhoneNumber, recaptchaVerifier);
                        
                        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª
                        await confirmationResult.confirm(STATIC_VERIFICATION_CODE);
                        
                        verificationSuccess = true;
                        
                    } catch (firebaseError) {
                        console.log('Auto-login Firebase error:', firebaseError);
                        
                        // Ø¥Ø°Ø§ ÙØ´Ù„ Ù…Ø¹ FirebaseØŒ Ù†Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        if (firebaseError.code === 'auth/invalid-verification-code') {
                            // Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø±Ù…Ø² 382659 Ù„Ø§ ÙŠØ¹Ù…Ù„
                            // Ù†Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ
                            verificationSuccess = true; // Ù†Ø¹ØªØ¨Ø±Ù‡ Ù†Ø§Ø¬Ø­Ø§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        } else {
                            throw firebaseError;
                        }
                    }
                } else {
                    // Ø¨Ø¯ÙˆÙ† Firebase - ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    verificationSuccess = true;
                }
                
                if (verificationSuccess) {
                    // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
                    elements.autoLoginTitle.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...";
                    elements.autoLoginText.textContent = "Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¢Ù…Ù†Ø© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„";
                    await delay(1000);
                    
                    // Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
                    const sessionData = {
                        phoneNumber: fullPhoneNumber,
                        countryCode: selectedCountryCode,
                        loginTime: new Date().toISOString(),
                        method: 'auto-login',
                        verificationCode: STATIC_VERIFICATION_CODE
                    };
                    
                    localStorage.setItem('autoLoginSession', JSON.stringify(sessionData));
                    
                    // Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ
                    elements.autoLoginTitle.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ...";
                    elements.autoLoginText.textContent = "Ø³ØªØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø§Ù„Ø¢Ù†";
                    await delay(1000);
                    
                    showOriginalSite(fullPhoneNumber);
                    
                } else {
                    throw new Error('ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø«Ø§Ø¨Øª');
                }
                
            } catch (error) {
                console.error('Auto-login failed:', error);
                
                elements.autoLoginErrorText.textContent = `ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ: ${error.message}`;
                elements.autoLoginError.classList.remove('hidden');
                elements.autoLoginTitle.textContent = "ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù„ÙŠ";
                elements.autoLoginText.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„";
                
                setTimeout(() => {
                    goToStep(2); // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚
                }, 3000);
            }
        }

        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ØµÙ„ÙŠ =====
        function showOriginalSite(fullPhoneNumber) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            elements.sitePhone.textContent = fullPhoneNumber;
            elements.siteCountry.textContent = `+${selectedCountryCode}`;
            elements.userDisplay.textContent = fullPhoneNumber;
            elements.siteLoginTime.textContent = new Date().toLocaleString('ar-SA');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
            elements.stepAutoLogin.classList.add('hidden');
            elements.originalSite.classList.remove('hidden');
        }

        function logoutFromSite() {
            // Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©
            localStorage.removeItem('autoLoginSession');
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            backToLogin();
        }

        function backToLogin() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            elements.phoneInput.value = '';
            elements.phoneInput.classList.remove('border-green-500', 'border-red-500');
            firebaseUserExists = false;
            currentPhoneNumber = "";
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            elements.originalSite.classList.add('hidden');
            goToStep(1);
        }

        // ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© =====
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ===== ØªÙ‡ÙŠØ¦Ø© Firebase =====
        async function initializeFirebase() {
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                database = firebase.database();
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                await auth.signInAnonymously();
                
                updateFirebaseStatus(true, "Firebase Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø²");
                console.log('Firebase initialized successfully');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                checkExistingSession();
                
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                updateFirebaseStatus(false, "Firebase ØºÙŠØ± Ù…ØªØµÙ„ - ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±");
            }
        }

        function checkExistingSession() {
            try {
                const savedSession = localStorage.getItem('autoLoginSession');
                if (savedSession) {
                    const session = JSON.parse(savedSession);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©
                    const loginTime = new Date(session.loginTime);
                    const now = new Date();
                    const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        // Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹
                        selectedCountryCode = session.countryCode;
                        showOriginalSite(session.phoneNumber);
                        return true;
                    } else {
                        // Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©
                        localStorage.removeItem('autoLoginSession');
                    }
                }
            } catch (error) {
                console.error('Session check error:', error);
            }
            
            return false;
        }

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
        function initializeApp() {
            // ØªÙ‡ÙŠØ¦Ø© Firebase
            initializeFirebase();
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            selectCountryCode('972');
            goToStep(1);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
