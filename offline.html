<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø±Ù…Ø²</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
        }
        .btn-primary {
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
        .solution-card {
            border-left: 4px solid #10b981;
            transition: all 0.3s ease;
        }
        .solution-card:hover {
            transform: translateX(-5px);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 min-h-screen">
    <div class="w-full max-w-4xl mx-auto">
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">
                ğŸ”§ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… ÙˆØµÙˆÙ„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
            </h1>
            <p class="text-gray-200">Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¹Ù…Ù„ ÙˆÙ„ÙƒÙ† Ø§Ù„Ø±Ù…Ø² Ù„Ø§ ÙŠØµÙ„ Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙƒ</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙŠØ³Ø±Ù‰: Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div class="card rounded-2xl shadow-2xl p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“± ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h2>
                
                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
                <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                        <span class="text-green-700 font-medium">Firebase Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„</span>
                    </div>
                </div>
                
                <!-- reCAPTCHA Container -->
                <div id="recaptcha-container" class="mb-4"></div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
                <div id="phone-auth-container">
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2 font-medium">
                            Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </label>
                        
                        <div class="flex">
                            <div class="flex items-center justify-center bg-gray-100 rounded-r-lg px-4 border border-gray-300 border-l-0 font-bold text-gray-700">
                                +972
                            </div>
                            <input 
                                type="tel" 
                                id="phone" 
                                class="flex-1 p-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
                                placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø­Ù‚ÙŠÙ‚ÙŠ"
                                dir="ltr"
                                maxlength="9"
                            >
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            âš ï¸ <strong>Ù‡Ø§Ù…:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
                        </p>
                    </div>
                    
                    <div class="space-y-3">
                        <button 
                            id="send-real-btn" 
                            class="btn-primary w-full text-white font-bold py-3 px-4 rounded-lg"
                        >
                            Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø­Ù‚ÙŠÙ‚ÙŠ Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙŠ
                        </button>
                        
                        <button 
                            id="send-test-btn" 
                            class="w-full bg-yellow-100 text-yellow-800 border border-yellow-300 font-bold py-3 px-4 rounded-lg hover:bg-yellow-200 transition"
                        >
                            ğŸ§ª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¨Ø¯ÙˆÙ† Ø¥Ø±Ø³Ø§Ù„ ÙØ¹Ù„ÙŠ)
                        </button>
                    </div>
                </div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ -->
                <div id="verify-code-container" class="hidden">
                    <div class="mb-6">
                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-700">
                                <strong>ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰:</strong> 
                                <span id="verify-phone-number" class="font-mono">+972 XXXXXXXX</span>
                            </p>
                            <p class="text-xs text-blue-600 mt-1" id="send-status">
                                âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Firebase
                            </p>
                        </div>
                        
                        <label class="block text-gray-700 mb-2 font-medium">
                            Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
                        </label>
                        
                        <div class="mb-4">
                            <div class="flex justify-center space-x-2 mb-4">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                                <input type="text" maxlength="1" class="code-input w-12 h-12 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-indigo-500">
                            </div>
                            <input type="hidden" id="verification-code">
                            
                            <div class="text-center">
                                <button 
                                    id="simulate-receive-btn" 
                                    class="text-sm text-indigo-600 hover:text-indigo-800"
                                >
                                    ğŸ”„ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ù…Ø²
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button 
                                id="verify-code-btn" 
                                class="btn-primary flex-1 text-white font-bold py-3 px-4 rounded-lg"
                            >
                                ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²
                            </button>
                            <button 
                                id="back-btn" 
                                class="flex-1 border border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg"
                            >
                                Ø±Ø¬ÙˆØ¹
                            </button>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button id="resend-code-btn" class="text-indigo-600 font-medium">
                                Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² (<span id="countdown">60</span> Ø«Ø§Ù†ÙŠØ©)
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                <div id="user-info" class="hidden">
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="text-center">
                            <div class="text-4xl mb-2">ğŸ‰</div>
                            <h3 class="font-bold text-green-800 mb-1">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                            <p id="user-phone" class="text-green-700 mb-3">+972 XXXXXXXX</p>
                            <button 
                                id="logout-btn" 
                                class="w-full bg-white text-green-700 border border-green-300 font-bold py-2 px-4 rounded-lg hover:bg-green-50"
                            >
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰: Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© -->
            <div class="space-y-4">
                <!-- Ø§Ù„Ø­Ù„ 1: Ø±Ù‚Ù… Ø­Ù‚ÙŠÙ‚ÙŠ -->
                <div class="card rounded-2xl shadow-xl p-5 solution-card">
                    <div class="flex items-start mb-3">
                        <div class="text-2xl mr-3">ğŸ“±</div>
                        <div>
                            <h3 class="font-bold text-gray-800 mb-2">1. Ø§Ø³ØªØ®Ø¯Ù… Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø­Ù‚ÙŠÙ‚ÙŠ</h3>
                            <p class="text-sm text-gray-600">
                                Firebase <strong>Ù„Ø§ ÙŠØ±Ø³Ù„ Ø±Ù…ÙˆØ² Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆÙ‡Ù…ÙŠØ©</strong>. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù„Ø¯Ù‰ Ø´Ø±ÙƒØ© Ø§ØªØµØ§Ù„Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©.
                            </p>
                            <div class="mt-3">
                                <button 
                                    onclick="document.getElementById('phone').value = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ø¨Ø¯ÙˆÙ† +972):')"
                                    class="text-sm bg-indigo-100 text-indigo-700 px-3 py-1 rounded hover:bg-indigo-200"
                                >
                                    Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø­Ù‚ÙŠÙ‚ÙŠ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ù„ 2: Ø±ØµÙŠØ¯ Firebase -->
                <div class="card rounded-2xl shadow-xl p-5 solution-card">
                    <div class="flex items-start mb-3">
                        <div class="text-2xl mr-3">ğŸ’°</div>
                        <div>
                            <h3 class="font-bold text-gray-800 mb-2">2. ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ Firebase</h3>
                            <p class="text-sm text-gray-600">
                                Ù…Ø´Ø±ÙˆØ¹ Firebase Ù‚Ø¯ ÙŠÙƒÙˆÙ† <strong>ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</strong> (10,000 Ø±Ø³Ø§Ù„Ø© Ø´Ù‡Ø±ÙŠØ©).
                            </p>
                            <div class="mt-3">
                                <a href="https://console.firebase.google.com/project/aasa-8a079/usage" 
                                   target="_blank"
                                   class="text-sm bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200 inline-block mr-2">
                                    ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                                </a>
                                <button 
                                    onclick="checkFirebaseQuota()"
                                    class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200"
                                >
                                    Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±ØµÙŠØ¯
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ù„ 3: Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø© -->
                <div class="card rounded-2xl shadow-xl p-5 solution-card">
                    <div class="flex items-start mb-3">
                        <div class="text-2xl mr-3">ğŸ¢</div>
                        <div>
                            <h3 class="font-bold text-gray-800 mb-2">3. Ù…Ø´ÙƒÙ„Ø© Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
                            <p class="text-sm text-gray-600">
                                Ø¨Ø¹Ø¶ Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª <strong>ØªØ­Ø¬Ø¨ Ø±Ø³Ø§Ø¦Ù„ Firebase</strong>. Ø¬Ø±Ø¨ Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§ØªØµØ§Ù„Ø§Øª Ù…Ø®ØªÙ„ÙØ©.
                            </p>
                            <div class="mt-3">
                                <button 
                                    onclick="showCarrierInfo()"
                                    class="text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded hover:bg-purple-200"
                                >
                                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ù„ 4: Ø¨Ø¯Ø§Ø¦Ù„ -->
                <div class="card rounded-2xl shadow-xl p-5 solution-card">
                    <div class="flex items-start mb-3">
                        <div class="text-2xl mr-3">ğŸ”„</div>
                        <div>
                            <h3 class="font-bold text-gray-800 mb-2">4. Ø¨Ø¯Ø§Ø¦Ù„ ÙˆØ­Ù„ÙˆÙ„ Ø£Ø®Ø±Ù‰</h3>
                            <div class="space-y-2 text-sm text-gray-600">
                                <p>â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø£Ø¬Ù†Ø¨ÙŠ</strong> Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                                <p>â€¢ ØªÙØ¹ÙŠÙ„ <strong>Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬</strong> ÙÙŠ Firebase</p>
                                <p>â€¢ ØªØ¬Ø±Ø¨Ø© <strong>Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚</strong> Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙˆÙŠØ¨</p>
                            </div>
                            <div class="mt-3">
                                <button 
                                    onclick="showAlternativeNumbers()"
                                    class="text-sm bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200"
                                >
                                    Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
                <div class="card rounded-2xl shadow-xl p-5 bg-gray-50">
                    <h3 class="font-bold text-gray-800 mb-3">ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button 
                            onclick="testFirebaseConnection()"
                            class="p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-sm"
                        >
                            ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase
                        </button>
                        <button 
                            onclick="resetRecaptcha()"
                            class="p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-sm"
                        >
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† reCAPTCHA
                        </button>
                        <button 
                            onclick="viewConsoleLogs()"
                            class="p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-sm"
                        >
                            ğŸ“‹ Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                        </button>
                        <button 
                            onclick="simulateSuccess()"
                            class="p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-sm"
                        >
                            âœ… Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¬Ø§Ø­
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div id="global-message" class="hidden fixed bottom-4 left-4 right-4 bg-white border border-gray-300 rounded-lg shadow-xl p-4 max-w-md mx-auto z-50">
            <div class="flex justify-between items-start">
                <div id="message-content"></div>
                <button onclick="document.getElementById('global-message').classList.add('hidden')" class="text-gray-500 hover:text-gray-700">
                    âœ•
                </button>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBWfV0Z1yKxJ-lGJHzi5gStMGTE3CNxmMg",
            authDomain: "aasa-8a079.firebaseapp.com",
            projectId: "aasa-8a079",
            storageBucket: "aasa-8a079.firebasestorage.app",
            messagingSenderId: "849330713582",
            appId: "1:849330713582:web:7a11b11ebdb5cdcc8b14ff",
            measurementId: "G-LY2WSQ21GE"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let app;
        let auth;
        let recaptchaVerifier;
        let confirmationResult = null;
        let countdownInterval = null;
        let countdownTime = 60;
        let isTestMode = false;

        // Ø¹Ù†Ø§ØµØ± DOM
        const elements = {
            phoneInput: document.getElementById('phone'),
            sendRealBtn: document.getElementById('send-real-btn'),
            sendTestBtn: document.getElementById('send-test-btn'),
            verifyCodeBtn: document.getElementById('verify-code-btn'),
            resendCodeBtn: document.getElementById('resend-code-btn'),
            backBtn: document.getElementById('back-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            simulateReceiveBtn: document.getElementById('simulate-receive-btn'),
            phoneAuthContainer: document.getElementById('phone-auth-container'),
            verifyCodeContainer: document.getElementById('verify-code-container'),
            userInfo: document.getElementById('user-info'),
            verifyPhoneNumber: document.getElementById('verify-phone-number'),
            sendStatus: document.getElementById('send-status'),
            userPhone: document.getElementById('user-phone'),
            countdownSpan: document.getElementById('countdown'),
            recaptchaContainer: document.getElementById('recaptcha-container'),
            codeInputs: document.querySelectorAll('.code-input'),
            verificationCode: document.getElementById('verification-code'),
            globalMessage: document.getElementById('global-message'),
            messageContent: document.getElementById('message-content')
        };

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
        function showGlobalMessage(text, type = 'info') {
            elements.messageContent.innerHTML = text;
            elements.globalMessage.className = 'fixed bottom-4 left-4 right-4 bg-white border rounded-lg shadow-xl p-4 max-w-md mx-auto z-50';
            
            if (type === 'success') {
                elements.globalMessage.classList.add('border-green-300', 'bg-green-50');
            } else if (type === 'error') {
                elements.globalMessage.classList.add('border-red-300', 'bg-red-50');
            } else if (type === 'warning') {
                elements.globalMessage.classList.add('border-yellow-300', 'bg-yellow-50');
            } else {
                elements.globalMessage.classList.add('border-blue-300', 'bg-blue-50');
            }
            
            elements.globalMessage.classList.remove('hidden');
            
            setTimeout(() => {
                elements.globalMessage.classList.add('hidden');
            }, 5000);
        }

        // ØªÙ‡ÙŠØ¦Ø© reCAPTCHA
        function initializeRecaptcha() {
            try {
                if (recaptchaVerifier) {
                    recaptchaVerifier.clear();
                }
                
                recaptchaVerifier = new firebase.auth.RecaptchaVerifier(elements.recaptchaContainer, {
                    'size': 'normal',
                    'callback': function(response) {
                        console.log("reCAPTCHA solved:", response);
                        elements.sendRealBtn.disabled = false;
                    },
                    'expired-callback': function() {
                        console.log("reCAPTCHA expired");
                        showGlobalMessage('Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'warning');
                        elements.sendRealBtn.disabled = true;
                    }
                });
                
                recaptchaVerifier.render();
                console.log("âœ… reCAPTCHA initialized");
                
            } catch (error) {
                console.error("âŒ reCAPTCHA error:", error);
                showGlobalMessage('Ø®Ø·Ø£ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù…Ù†ÙŠ', 'error');
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
        elements.codeInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                if (!/^\d*$/.test(e.target.value)) {
                    e.target.value = '';
                    return;
                }
                
                if (e.target.value && index < elements.codeInputs.length - 1) {
                    elements.codeInputs[index + 1].focus();
                }
                
                updateVerificationCode();
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    elements.codeInputs[index - 1].focus();
                }
            });
        });

        function updateVerificationCode() {
            let code = '';
            elements.codeInputs.forEach(input => {
                code += input.value;
            });
            elements.verificationCode.value = code;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
        function validatePhoneNumber(phone) {
            if (!phone.trim()) {
                return { valid: false, message: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ' };
            }
            
            const pattern = /^5[0-9]{8}$/;
            if (!pattern.test(phone.trim())) {
                return { 
                    valid: false, 
                    message: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù…' 
                };
            }
            
            return { valid: true };
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø­Ù‚ÙŠÙ‚ÙŠ
        async function sendRealCode() {
            const phone = elements.phoneInput.value.trim();
            const validation = validatePhoneNumber(phone);
            
            if (!validation.valid) {
                showGlobalMessage(validation.message, 'error');
                return;
            }
            
            const fullPhoneNumber = `+972${phone}`;
            
            showGlobalMessage(`Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø­Ù‚ÙŠÙ‚ÙŠ Ø¥Ù„Ù‰ ${fullPhoneNumber}...`, 'info');
            elements.sendRealBtn.disabled = true;
            elements.sendRealBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            try {
                confirmationResult = await auth.signInWithPhoneNumber(fullPhoneNumber, recaptchaVerifier);
                
                showGlobalMessage(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ ${fullPhoneNumber}`, 'success');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                elements.verifyPhoneNumber.textContent = fullPhoneNumber;
                elements.sendStatus.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                        <span>ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ</span>
                    </div>
                `;
                
                elements.phoneAuthContainer.classList.add('hidden');
                elements.verifyCodeContainer.classList.remove('hidden');
                
                startCountdown();
                elements.codeInputs[0].focus();
                
            } catch (error) {
                console.error("Firebase error:", error);
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
                let errorDetails = '';
                
                if (error.code === 'auth/quota-exceeded') {
                    errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„';
                    errorDetails = 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ Ù…Ø´Ø±ÙˆØ¹ Firebase';
                } else if (error.code === 'auth/invalid-phone-number') {
                    errorMessage = 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­';
                    errorDetails = 'ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù…';
                } else {
                    errorMessage = `Ø®Ø·Ø£: ${error.code}`;
                }
                
                showGlobalMessage(`${errorMessage}. ${errorDetails}`, 'error');
                
            } finally {
                elements.sendRealBtn.disabled = false;
                elements.sendRealBtn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø­Ù‚ÙŠÙ‚ÙŠ Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙŠ';
            }
        }

        // ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¨Ø¯ÙˆÙ† Ø¥Ø±Ø³Ø§Ù„ ÙØ¹Ù„ÙŠ)
        function sendTestCode() {
            const phone = elements.phoneInput.value.trim();
            const validation = validatePhoneNumber(phone);
            
            if (!validation.valid) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                elements.phoneInput.value = "599123456";
            }
            
            const fullPhoneNumber = `+972${elements.phoneInput.value.trim()}`;
            
            showGlobalMessage(`ğŸ§ª [ÙˆØ¶Ø¹ Ø§Ø®ØªØ¨Ø§Ø±] ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø¥Ù„Ù‰ ${fullPhoneNumber}`, 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø§Ø¬Ø­
            elements.verifyPhoneNumber.textContent = fullPhoneNumber;
            elements.sendStatus.innerHTML = `
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse"></div>
                    <span>ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: <strong>123456</strong></span>
                </div>
            `;
            
            elements.phoneAuthContainer.classList.add('hidden');
            elements.verifyCodeContainer.classList.remove('hidden');
            
            startCountdown();
            elements.codeInputs[0].focus();
            
            isTestMode = true;
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ù…Ø²
        function simulateCodeReceive() {
            const testCode = "123456";
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            elements.codeInputs.forEach((input, index) => {
                input.value = testCode[index];
            });
            
            updateVerificationCode();
            
            showGlobalMessage(`ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ù…Ø²: ${testCode}`, 'success');
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø­Ù‚Ù„ Ø§Ù„Ø£Ø®ÙŠØ±
            elements.codeInputs[5].focus();
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
        async function verifyCode() {
            const code = elements.verificationCode.value;
            
            if (code.length !== 6) {
                showGlobalMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…', 'error');
                return;
            }
            
            elements.verifyCodeBtn.disabled = true;
            elements.verifyCodeBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            if (isTestMode) {
                // ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                setTimeout(() => {
                    showGlobalMessage('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­ (ÙˆØ¶Ø¹ Ø§Ø®ØªØ¨Ø§Ø±)', 'success');
                    
                    elements.userPhone.textContent = elements.verifyPhoneNumber.textContent;
                    elements.verifyCodeContainer.classList.add('hidden');
                    elements.userInfo.classList.remove('hidden');
                    
                    elements.verifyCodeBtn.disabled = false;
                    elements.verifyCodeBtn.textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²';
                    
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
                
            } else {
                // ÙˆØ¶Ø¹ Ø­Ù‚ÙŠÙ‚ÙŠ
                try {
                    const result = await confirmationResult.confirm(code);
                    const user = result.user;
                    
                    showGlobalMessage('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    
                    elements.userPhone.textContent = user.phoneNumber;
                    elements.verifyCodeContainer.classList.add('hidden');
                    elements.userInfo.classList.remove('hidden');
                    
                } catch (error) {
                    console.error("Verification error:", error);
                    showGlobalMessage('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                    
                    elements.codeInputs.forEach(input => {
                        input.classList.add('border-red-500');
                        setTimeout(() => input.classList.remove('border-red-500'), 1000);
                    });
                    
                } finally {
                    elements.verifyCodeBtn.disabled = false;
                    elements.verifyCodeBtn.textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²';
                }
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startCountdown() {
            countdownTime = 60;
            elements.countdownSpan.textContent = countdownTime;
            elements.resendCodeBtn.disabled = true;
            elements.resendCodeBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            countdownInterval = setInterval(() => {
                countdownTime--;
                elements.countdownSpan.textContent = countdownTime;
                
                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    elements.resendCodeBtn.disabled = false;
                    elements.resendCodeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }, 1000);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        function resendCode() {
            if (isTestMode) {
                showGlobalMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² (ÙˆØ¶Ø¹ Ø§Ø®ØªØ¨Ø§Ø±)', 'info');
                startCountdown();
                
                elements.codeInputs.forEach(input => input.value = '');
                updateVerificationCode();
                elements.codeInputs[0].focus();
                
            } else if (confirmationResult) {
                showGlobalMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...', 'info');
                sendRealCode();
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase
        async function testFirebaseConnection() {
            try {
                showGlobalMessage('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase...', 'info');
                
                const response = await fetch(`https://${firebaseConfig.projectId}.firebaseapp.com/__/auth/iframe`);
                
                if (response.ok) {
                    showGlobalMessage('âœ… Ø§ØªØµØ§Ù„ Firebase ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'success');
                } else {
                    throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„');
                }
                
            } catch (error) {
                showGlobalMessage('âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase', 'error');
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ Firebase
        async function checkFirebaseQuota() {
            showGlobalMessage(`
                <div>
                    <p class="font-medium mb-2">ğŸ’° ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ Firebase:</p>
                    <ol class="text-sm list-decimal list-inside space-y-1">
                        <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://console.firebase.google.com/project/aasa-8a079/usage" target="_blank" class="text-blue-600 hover:underline">ØµÙØ­Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a></li>
                        <li>ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø³Ù… <strong>Authentication</strong></li>
                        <li>Ø§Ù†Ø¸Ø± Ø¥Ù„Ù‰ <strong>Phone Authentication</strong></li>
                        <li>Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ: 10,000 Ø±Ø³Ø§Ù„Ø©/Ø´Ù‡Ø±</li>
                    </ol>
                </div>
            `, 'info');
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† reCAPTCHA
        function resetRecaptcha() {
            if (recaptchaVerifier) {
                recaptchaVerifier.clear();
                elements.recaptchaContainer.innerHTML = '';
                initializeRecaptcha();
                showGlobalMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚', 'success');
            }
        }

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©
        function showCarrierInfo() {
            showGlobalMessage(`
                <div>
                    <p class="font-medium mb-2">ğŸ¢ Ù…Ø´Ø§ÙƒÙ„ Ù…Ø²ÙˆØ¯ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©:</p>
                    <ul class="text-sm list-disc list-inside space-y-1">
                        <li>Ø¨Ø¹Ø¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª ØªØ­Ø¬Ø¨ Ø±Ø³Ø§Ø¦Ù„ Firebase</li>
                        <li>Ø¬Ø±Ø¨ Ù…Ø¹ <strong>Jawwal</strong> Ø£Ùˆ <strong>Ooredoo</strong></li>
                        <li>Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ¬Ø±Ø¨Ø© Ø±Ù‚Ù… Ù…Ù† Ø¯ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰</li>
                        <li>Ø§Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ <strong>TextNow</strong> Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø£Ø¬Ù†Ø¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ</li>
                    </ul>
                </div>
            `, 'info');
        }

        // Ø¹Ø±Ø¶ Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function showAlternativeNumbers() {
            showGlobalMessage(`
                <div>
                    <p class="font-medium mb-2">ğŸŒ Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±:</p>
                    <ul class="text-sm space-y-1">
                        <li>ğŸ‡ºğŸ‡¸ Ø£Ù…Ø±ÙŠÙƒØ§: <code>+1 555 123 4567</code></li>
                        <li>ğŸ‡¬ğŸ‡§ Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§: <code>+44 7911 123456</code></li>
                        <li>ğŸ‡©ğŸ‡ª Ø£Ù„Ù…Ø§Ù†ÙŠØ§: <code>+49 151 12345678</code></li>
                        <li>Ø®Ø¯Ù…Ø§Øª Ø£Ø±Ù‚Ø§Ù… ÙˆÙ‡Ù…ÙŠØ©:
                            <a href="https://receive-sms.com" target="_blank" class="text-blue-600 hover:underline ml-2">receive-sms.com</a>
                        </li>
                    </ul>
                </div>
            `, 'info');
        }

        // Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function viewConsoleLogs() {
            showGlobalMessage(`
                <div>
                    <p class="font-medium mb-2">ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</p>
                    <div class="text-xs bg-gray-100 p-2 rounded font-mono">
                        1. âœ… Firebase initialized<br>
                        2. âœ… reCAPTCHA loaded<br>
                        3. ${confirmationResult ? 'âœ… Code sent successfully' : 'â³ Waiting for send'}<br>
                        4. ${isTestMode ? 'ğŸ§ª Test mode active' : 'ğŸ” Real mode active'}
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Ø§ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (F12) Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
                </div>
            `, 'info');
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¬Ø§Ø­ ÙƒØ§Ù…Ù„
        function simulateSuccess() {
            elements.phoneInput.value = "599123456";
            elements.verifyPhoneNumber.textContent = "+972599123456";
            elements.userPhone.textContent = "+972599123456";
            
            showGlobalMessage(`
                <div class="text-center">
                    <div class="text-2xl mb-2">ğŸ‰</div>
                    <p class="font-medium">Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¬Ø§Ø­ ÙƒØ§Ù…Ù„Ø©!</p>
                    <p class="text-sm">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø±Ø¨Ø© Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„</p>
                </div>
            `, 'success');
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            elements.sendRealBtn.addEventListener('click', sendRealCode);
            elements.sendTestBtn.addEventListener('click', sendTestCode);
            elements.verifyCodeBtn.addEventListener('click', verifyCode);
            elements.resendCodeBtn.addEventListener('click', resendCode);
            elements.backBtn.addEventListener('click', () => {
                elements.verifyCodeContainer.classList.add('hidden');
                elements.phoneAuthContainer.classList.remove('hidden');
                elements.userInfo.classList.add('hidden');
                
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
            });
            elements.simulateReceiveBtn.addEventListener('click', simulateCodeReceive);
            elements.logoutBtn.addEventListener('click', () => {
                if (auth && auth.currentUser) {
                    auth.signOut();
                }
                
                elements.userInfo.classList.add('hidden');
                elements.phoneAuthContainer.classList.remove('hidden');
                
                showGlobalMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'success');
                
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function initializeApp() {
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                console.log("âœ… Firebase initialized");
                
                initializeRecaptcha();
                setupEventListeners();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        elements.userPhone.textContent = user.phoneNumber;
                        elements.phoneAuthContainer.classList.add('hidden');
                        elements.verifyCodeContainer.classList.add('hidden');
                        elements.userInfo.classList.remove('hidden');
                    }
                });
                
            } catch (error) {
                console.error("âŒ Initialization error:", error);
                showGlobalMessage('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>