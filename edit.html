<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø­Ø±Ø± ÙƒØ§ØªØ§Ù„ÙˆØ¬ GitHub</title>
  <style>
    body { font-family: sans-serif; direction: rtl; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    td[contenteditable] { background-color: #fff8dc; }
    button, select { padding: 6px 12px; margin: 5px; }
  </style>
</head>
<body>

<h2>ğŸ“‹ Ù…Ø­Ø±Ø± ÙƒØ§ØªØ§Ù„ÙˆØ¬ GitHub</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù:</label>
<select id="fileSelect">
  <option value="test.md">test.md (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
  <option value="abc.md">abc.md</option>
  <option value="lcd.md">lcd.md</option>
</select>
<button onclick="loadFile()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</button>
<button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
<button onclick="saveFile()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>

<table id="catalogTable">
  <thead>
    <tr><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</th><th>Ø­Ø°Ù</th></tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
const username = "mohammad-shehadeh";
const repo = "price";
const token = "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"; // âš ï¸ Ø¹Ø¯Ù‘Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§

function addRow(c = "", i = "", p = "", l = "") {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td contenteditable="true">${c}</td>
    <td contenteditable="true">${i}</td>
    <td contenteditable="true">${p}</td>
    <td contenteditable="true">${l}</td>
    <td><button onclick="this.closest('tr').remove();">ğŸ—‘ï¸</button></td>
  `;
  document.getElementById("tableBody").appendChild(row);
}

function getMarkdownFromTable() {
  const rows = document.querySelectorAll("#tableBody tr");
  return Array.from(rows).map(row => {
    return Array.from(row.querySelectorAll("td")).slice(0, 4)
      .map(cell => cell.innerText.trim()).join("/");
  }).join("\n");
}

async function loadFile() {
  const filename = document.getElementById("fileSelect").value;
  const url = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;
  const res = await fetch(url, { headers: { Authorization: `token ${token}` } });
  const data = await res.json();
  const content = atob(data.content);

  document.getElementById("tableBody").innerHTML = "";
  content.trim().split("\n").forEach(line => {
    const [c, i, p, l] = line.split("/");
    addRow(c || "", i || "", p || "", l || "");
  });
}

async function saveFile() {
  const filename = document.getElementById("fileSelect").value;
  const url = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;
  const newContent = getMarkdownFromTable();
  const res = await fetch(url, { headers: { Authorization: `token ${token}` } });
  const data = await res.json();

  const saveRes = await fetch(url, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      Authorization: `token ${token}`
    },
    body: JSON.stringify({
      message: "ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ÙŠ",
      content: btoa(unescape(encodeURIComponent(newContent))),
      sha: data.sha
    })
  });

  if (saveRes.ok) {
    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª!");
  } else {
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸.");
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„
window.onload = loadFile;
</script>

</body>
</html>
