<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Recorder</title>
</head>
<body>
    <h1>تسجيل البيانات</h1>
    <form id="dataForm">
        <label for="model">النوع:</label>
        <input type="text" id="model" required><br><br>
        
        <label for="number">الرقم:</label>
        <input type="text" id="number" required><br><br>
        
        <button type="submit">حفظ البيانات</button>
    </form>

    <p id="message"></p>

    <script>const form = document.getElementById("dataForm");
        const message = document.getElementById("message");
        
        // إعدادات GitHub API
        const GITHUB_TOKEN = "YOUR_GITHUB_PERSONAL_ACCESS_TOKEN"; // استبدل بـ Access Token الخاص بك
        const REPO_OWNER = "YOUR_GITHUB_USERNAME"; // اسم المستخدم الخاص بك على GitHub
        const REPO_NAME = "YOUR_REPOSITORY_NAME"; // اسم المستودع
        const FILE_PATH = "test.txt"; // مسار الملف داخل المستودع
        const BRANCH = "main"; // اسم الفرع الرئيسي
        
        // عند إرسال النموذج
        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            
            const model = document.getElementById("model").value.trim();
            const number = document.getElementById("number").value.trim();
        
            if (!model || !number) {
                alert("يرجى ملء جميع الحقول.");
                return;
            }
        
            const newData = `${model}/${number}\n`;
        
            try {
                // جلب محتوى الملف الحالي
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    headers: {
                        Authorization: `Bearer ${GITHUB_TOKEN}`,
                        Accept: "application/vnd.github.v3+json",
                    },
                });
        
                const fileData = await response.json();
                const currentContent = atob(fileData.content); // فك تشفير المحتوى الحالي
                const updatedContent = currentContent + newData; // إضافة البيانات الجديدة
        
                // تحديث الملف على GitHub
                const updateResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    method: "PUT",
                    headers: {
                        Authorization: `Bearer ${GITHUB_TOKEN}`,
                        Accept: "application/vnd.github.v3+json",
                    },
                    body: JSON.stringify({
                        message: "Add new data",
                        content: btoa(updatedContent), // تشفير المحتوى الجديد
                        sha: fileData.sha, // SHA للملف الحالي
                        branch: BRANCH,
                    }),
                });
        
                if (updateResponse.ok) {
                    message.textContent = "تم حفظ البيانات بنجاح!";
                    form.reset(); // إعادة تعيين النموذج
                } else {
                    throw new Error("تعذر حفظ البيانات.");
                }
            } catch (error) {
                console.error("حدث خطأ:", error);
                message.textContent = "حدث خطأ أثناء حفظ البيانات.";
            }
        });
        </script>
</body>
</html>
